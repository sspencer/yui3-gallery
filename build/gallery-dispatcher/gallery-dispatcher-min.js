YUI.add("gallery-dispatcher",function(B){var N=B.UA,G=B.ClassNameManager.getClassName,I="dispatcher",D=".",O="start",R="purge",U="change",S="load",F="uri",E="content",Q=G(I),C=G(I,"loading"),A=D+Q,H=B.Lang,J=H.isBoolean,M=H.isString,K=H.isObject,P=function(){P.superclass.constructor.apply(this,arguments);};function T(V){var L=B.Node.create("<div></div>"),W={};L.setContent(V);W.css=L.all("style, link[type=text/css]").each(function(X){L.removeChild(X);});W.js=L.all("script").each(function(X){L.removeChild(X);});W.content=L.get("innerHTML");return W;}B.mix(P,{NAME:I,_hashtable:[],ATTRS:{autopurge:{value:true,validator:J},uri:{value:null,setter:function(L){this.stop();this._io=this._fetch(L);return L;},validator:M},content:{value:"",setter:function(L){this.stop();L=this._dispatch(L);return L;},validator:M},loading:{value:false,validator:J,setter:function(L){if(L){this._node.addClass(C);}else{this._node.removeClass(C);}return L;}}}});B.extend(P,B.Base,{_history:[],_node:null,_queue:null,_io:null,initializer:function(L){this._queue=new B.AsyncQueue();if(!K(L)||!L.node||!(this._node=B.one(L.node))){return;}this.publish(O);this.publish(R);this.publish(U);this.publish(S);},destructor:function(){this.stop();this._node=null;this._queue=null;this._io=null;},stop:function(){this._queue.stop();if(this._io){this._io.abort();}return this;},_dispatch:function(L){var W=T(L),V=this._queue,X=this._node;W.css.each(function(Y){if(Y&&Y.get("href")){V.add({fn:function(){B.Get.css(Y.get("href"),{onFailure:function(Z){},onEnd:function(){V.run();}});},autoContinue:false});}else{V.add({fn:function(){var b=Y.get("ownerDocument"),Z=b.one("head")||b.get("documentElement"),a=B.Node.create("<style></style>");Z.replaceChild(Y,Z.appendChild(a));}});}});if(this.get("autopurge")){V.add({fn:function(){X.get("children").each(function(Y){Y.purge(true);});}});}V.add({fn:function(){X.setContent(W.content);}});W.js.each(function(Y){if(Y&&Y.get("src")){V.add({fn:function(){B.Get.script(Y.get("src"),{onFailure:function(Z){},onEnd:function(Z){Z.purge();V.run();}});},autoContinue:false});}else{V.add({fn:function(){var b=Y.get("ownerDocument"),a=b.one("head")||b.get("documentElement"),Z=B.Node.create("<script><\/script>");a.replaceChild(Y,a.appendChild(Z));if(Y._node.text){Z._node.text=Y._node.text;}Y.remove();}});}});this._queue.run();},_fetch:function(V,L){L=L||{method:"GET"};L.on={start:function(){},success:function(W,X){this.set(E,X.responseText);},failure:function(W,X){},end:function(){}};L.context=this;return B.io(V,L);},_destroy:function(L,V){}});B.Dispatcher=P;},"gallery-2010.02.17-20",{requires:["base-base","node-base","io-base","get","async-queue","classnamemanager"]});