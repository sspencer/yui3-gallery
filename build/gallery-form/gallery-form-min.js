YUI.add("gallery-form",function(C){function H(){H.superclass.constructor.apply(this,arguments);}C.mix(H,{NAME:"form",ATTRS:{method:{value:"post",validator:function(L){return this._validateMethod(L);},setter:function(L){return L.toLowerCase();}},action:{value:"",validator:C.Lang.isString},fields:{writeOnce:true,validator:function(L){return this._validateFields(L);},setter:function(L){return this._setFields(L);}},inlineValidation:{value:false,validator:C.Lang.isBoolean}},HTML_PARSER:{action:function(L){return this._parseAction(L);},method:function(L){return this._parseMethod(L);},fields:function(L){return this._parseFields(L);}},FORM_TEMPLATE:"<form></form>"});C.extend(H,C.Widget,{_formNode:null,_ioIds:null,_validateMethod:function(L){if(!C.Lang.isString(L)){return false;}if(L.toLowerCase()!="get"&&L.toLowerCase()!="post"){return false;}return true;},_validateFields:function(M){if(!C.Lang.isArray(M)){return false;}var L=true;C.Array.each(M,function(P,O,N){if((!P instanceof C.FormField)||(!C.Lang.isObject(P))){L=false;}});return L;},_setFields:function(L){L=L||[];var M,N;C.Array.each(L,function(Q,P,O){if(!Q._classes){N=Q.type;if(C.Lang.isFunction(N)){M=N;}else{if(N=="hidden"){M=C.HiddenField;}else{if(N=="checkbox"){M=C.CheckboxField;}else{if(N=="password"){M=C.PasswordField;}else{if(N=="textarea"){M=C.TextareaField;}else{if(N=="select"){M=C.SelectField;}else{if(N=="choice"){M=C.ChoiceField;}else{if(N=="button"||N=="submit"||N=="reset"){M=C.Button;if(N=="submit"){Q.onclick={fn:this.submit,scope:this};}else{if(N=="reset"){Q.onclick={fn:this.reset,scope:this};}}}else{M=C.TextField;}}}}}}}}L[P]=new M(Q);}},this);return L;},_parseAction:function(L){var M=L.one("form");if(M){return M.get("action");}},_parseMethod:function(L){var M=L.one("form");if(M){return M.get("method");}},_parseFields:function(M){var N=M.all("*"),O=M.all("label"),L=[];N.each(function(R,Q,P){var V=R.get("nodeName"),T=R.get("id"),S,U=[];if(V=="INPUT"){S={type:R.get("type"),name:R.get("name"),value:R.get("value")};if(S.type=="submit"||S.type=="reset"||S.type=="button"){S.label=R.get("value");}}else{if(V=="BUTTON"){S={type:"button",name:R.get("name"),label:R.get("innerHTML")};}else{if(V=="SELECT"){R.all("option").each(function(X,Y,W){U.push({label:X.get("innerHTML"),value:X.get("value")});});S={type:"select",name:R.get("name"),choices:U};}else{if(V=="TEXTAREA"){S={type:"textarea",name:R.get("name"),value:R.get("innerHTML")};}}}}if(S){if(T){S.id=T;O.some(function(X,Y,W){if(X.get("htmlFor")==T){S.label=X.get("innerHTML");}});}L.push(S);}R.remove();});return L;},_renderFormNode:function(){var L=this.get("contentBox"),M=L.query("form");if(!M){M=C.Node.create(H.FORM_TEMPLATE);L.appendChild(M);}this._formNode=M;},_renderFormFields:function(){var L=this.get("fields");C.Array.each(L,function(O,N,M){O.render(this._formNode);},this);},_syncFormAttributes:function(){this._formNode.setAttrs({action:this.get("action"),method:this.get("method"),id:this.get("id")});},_runValidation:function(){var L=this.get("fields"),M=true;C.Array.each(L,function(P,O,N){P.set("error",null);if(P.validateField()===false){M=false;}});return M;},_enableInlineValidation:function(){var L=this.get("fields");C.Array.each(L,function(O,N,M){O.set("validateInline",true);});},_disableInlineValidation:function(){var L=this.get("fields");C.Array.each(L,function(O,N,M){O.set("validateInline",false);});},_handleIOSuccess:function(L,M){if(typeof this._ioIds[L]!="undefined"){delete this._ioIds[L];this.fire("success",{response:M});}},_handleIOFailure:function(L,M){if(typeof this._ioIds[L]!="undefined"){this.fire("failure",{response:M});delete this._ioIds[L];}},reset:function(){this._formNode.reset();var L=this.get("fields");C.Array.each(L,function(O,N,M){O.clear();});},submit:function(){if(this._runValidation()){var O=this.get("action"),P=this.get("method"),L=this.get("fields"),N="",Q,M;C.Array.each(L,function(T,S,R){if(T.get("name")!==null){N+=encodeURIComponent(T.get("name"))+"="+(encodeURIComponent(T.get("value"))||"")+"&";}});M={method:P,data:N};Q=C.io(O,M);this._ioIds[Q.id]=Q;}},getField:function(M){var L=this.get("fields"),N;if(C.Lang.isNumber(M)){return L[M];}else{if(C.Lang.isString(M)){C.Array.each(L,function(Q,P,O){if(Q.get("name")==M){N=Q;}});return N;}}},initializer:function(L){this._ioIds={};this.publish("submit");this.publish("reset");this.publish("success");this.publish("failure");},destructor:function(){this._formNode=null;},renderUI:function(){this._renderFormNode();this._renderFormFields();},bindUI:function(){this._formNode.on("submit",C.bind(function(L){L.halt();},this));this.after("inlineValidationChange",C.bind(function(L){if(L.newValue===true){this._enableInlineValidation();}else{this._disableInlineValidation();}},this));this.after("success",C.bind(function(L){this.reset();},this));C.on("io:success",C.bind(this._handleIOSuccess,this));C.on("io:failure",C.bind(this._handleIOFailure,this));},syncUI:function(){this._syncFormAttributes();if(this.get("inlineValidation")===true){this._enableInlineValidation();}}});C.Form=H;function D(){D.superclass.constructor.apply(this,arguments);}C.mix(D,{NAME:"form-field",ATTRS:{id:{value:C.guid(),validator:C.Lang.isString,writeOnce:true},name:{validator:C.Lang.isString,writeOnce:true},value:{value:"",validator:C.Lang.isString},label:{value:"",validator:C.Lang.isString},validator:{value:function(L){return true;},validator:function(L){return this._validateValidator(L);},setter:function(L){return this._setValidator(L);}},error:{value:false,validator:function(L){return this._validateError(L);}},required:{value:false,validator:C.Lang.isBoolean},validateInline:{value:false,validator:C.Lang.isBoolean}},tabIndex:0,VALIDATE_EMAIL_ADDRESS:function(N,M){var L=/^([\w]+(?:\.[\w]+)*)@((?:[\w]+\.)*\w[\w]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;if(L.test(N)===false){M.set("error",D.INVALID_EMAIL_MESSAGE);return false;}return true;},INVALID_EMAIL_MESSAGE:"Please enter a valid email address",VALIDATE_PHONE_NUMBER:function(N,M){var L=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;
if(L.test(N)===false){M.set("error",D.INVALID_PHONE_NUMBER);return false;}return true;},INVALID_PHONE_NUMBER:"Please enter a valid phone number",VALIDATE_IP_ADDRESS:function(P,O){var M=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/,L,N=true;if(M.test(P)===false){N=false;}L=P.split(".");C.Array.each(L,function(R,S,Q){var T=parseInt(R,10);if(T<0||T>255){N=false;}});if(N===false){O.set("error",D.INVALID_IP_MESSAGE);}return N;},INVALID_IP_MESSAGE:"Please enter a valid IP address",VALIDATE_DATE:function(N,M){var L=/^([1-9]|1[0-2])(\-|\/)([0-2][0-9]|3[0-1])(\-|\/)(\d{4}|\d{2})$/;if(L.test(N)===false){M.set("error",D.INVALID_DATE_MESSAGE);return false;}return true;},INVALID_DATE_MESSAGE:"Please enter a a valid date",VALIDATE_TIME:function(N,M){var L=/^([1-9]|1[0-2]):[0-5]\d(:[0-5]\d(\.\d{1,3})?)?$/;if(L.test(N)===false){M.set("error",D.INVALID_TIME_MESSAGE);return false;}return true;},INVALID_TIME_MESSAGE:"Please enter a valid time",VALIDATE_POSTAL_CODE:function(O,N){var L,M=true;if(O.length==6||O.length==7){L=/^[a-zA-Z]\d[a-zA-Z](-|\s)?\d[a-zA-Z]\d$/;}else{if(O.length==5||O.length==10){L=/^\d{5}((-|\s)\d{4})?$/;}else{if(O.length>0){M=false;}}}if(M===false||(L&&L.test(O)===false)){N.set("error",D.INVALID_POSTAL_CODE_MESSAGE);return false;}return true;},INVALID_POSTAL_CODE_MESSAGE:"Please enter a valid postal code",VALIDATE_NO_SPECIAL_CHARS:function(N,M){var L=/^[a-zA-Z0-9]*$/;if(L.test(N)===false){M.set("error",D.INVALID_SPECIAL_CHARS);return false;}return true;},INVALID_SPECIAL_CHARS:"Please use only letters and numbers",INPUT_TEMPLATE:"<input>",TEXTAREA_TEMPLATE:"<textarea></textarea>",LABEL_TEMPLATE:"<label></label>",SELECT_TEMPLATE:"<select></select>"});C.extend(D,C.Widget,{_labelNode:null,_fieldNode:null,_errorNode:null,_nodeType:"text",_validateError:function(L){if(C.Lang.isString(L)){return true;}if(L===null||typeof L=="undefined"){return true;}return false;},_validateValidator:function(M){if(C.Lang.isString(M)){var L=/^(email|phone|ip|date|time|postal|special)$/;if(L.test(M)===true){return true;}}if(C.Lang.isFunction(M)){return true;}return false;},_setValidator:function(L){if(L=="email"){return D.VALIDATE_EMAIL_ADDRESS;}else{if(L=="phone"){return D.VALIDATE_PHONE_NUMBER;}else{if(L=="ip"){return D.VALIDATE_IP_ADDRESS;}else{if(L=="date"){return D.VALIDATE_DATE;}else{if(L=="time"){return D.VALIDATE_TIME;}else{if(L=="postal"){return D.VALIDATE_POSTAL_CODE;}else{if(L=="special"){return D.VALIDATE_NO_SPECIAL_CHARS;}}}}}}}return L;},_renderLabelNode:function(){var L=this.get("contentBox"),M=L.query("label");if(!M||M.get("for")!=this.get("id")){M=C.Node.create(D.LABEL_TEMPLATE);L.appendChild(M);}this._labelNode=M;},_renderFieldNode:function(){var L=this.get("contentBox"),M=L.query("#"+this.get("id"));if(!M){M=C.Node.create(D.INPUT_TEMPLATE);L.appendChild(M);}this._fieldNode=M;},_syncLabelNode:function(){if(this._labelNode){this._labelNode.setAttrs({innerHTML:this.get("label")});this._labelNode.setAttribute("for",this.get("id"));}},_syncFieldNode:function(){this._fieldNode.setAttrs({name:this.get("name"),type:this._nodeType,id:this.get("id"),value:this.get("value")});this._fieldNode.setAttribute("tabindex",D.tabIndex);D.tabIndex++;},_syncError:function(){var L=this.get("error");if(L){this._showError(L);}},_checkRequired:function(){if(this.get("required")===true&&this.get("value").length===0){return false;}return true;},_showError:function(M){var L=this.get("contentBox"),N=C.Node.create("<span>"+M+"</span>");N.addClass("error");L.insertBefore(N,this._labelNode);this._errorNode=N;},_clearError:function(){if(this._errorNode){var L=this.get("contentBox");L.removeChild(this._errorNode);this._errorNode=null;}},_enableInlineValidation:function(){this.after("valueChange",C.bind(this.validateField,this));},_disableInlineValidation:function(){this.detach("valueChange",this.validateField,this);},validateField:function(N){var M=this.get("value"),L=this.get("validator");this.set("error",null);if(N&&N.src!="ui"){return false;}if(!this._checkRequired()){this.set("error","This field is required");return false;}return L.call(this,M,this);},clear:function(){this.set("value","");this._fieldNode.set("value","");},initializer:function(){this.publish("blur");this.publish("change");this.publish("focus");},destructor:function(L){},renderUI:function(){this._renderLabelNode();this._renderFieldNode();},bindUI:function(){this._fieldNode.on("change",C.bind(function(L){this.set("value",this._fieldNode.get("value"),{src:"ui"});this.fire("change",L);},this));this.on("valueChange",C.bind(function(L){if(L.src!="ui"){this._fieldNode.set("value",L.newVal);}},this));this._fieldNode.on("blur",C.bind(function(L){this.set("value",this._fieldNode.get("value"),{src:"ui"});this.fire("blur",L);},this));this._fieldNode.on("focus",C.bind(function(L){this.fire("focus",L);},this));this.on("errorChange",C.bind(function(L){if(L.newVal){this._showError(L.newVal);}else{this._clearError();}},this));this.on("validateInlineChange",C.bind(function(L){if(L.newVal===true){this._enableInlineValidation();}else{this._disableInlineValidation();}},this));},syncUI:function(){this.get("boundingBox").removeAttribute("tabindex");this._syncLabelNode();this._syncFieldNode();this._syncError();if(this.get("validateInline")===true){this._enableInlineValidation();}}});C.FormField=D;function I(){I.superclass.constructor.apply(this,arguments);}C.mix(I,{NAME:"text-field"});C.extend(I,C.FormField,{_nodeType:"text"});C.TextField=I;function A(){A.superclass.constructor.apply(this,arguments);}C.mix(A,{NAME:"password-field"});C.extend(A,C.FormField,{_nodeType:"password"});C.PasswordField=A;function E(){E.superclass.constructor.apply(this,arguments);}C.mix(E,{NAME:"checkbox-field"});C.extend(E,C.FormField,{_nodeType:"checkbox",_getValue:function(M,L){if(this._fieldNode.get("checked")===true){return M;}else{return"";}},initializer:function(){E.superclass.initializer.apply(this,arguments);this.modifyAttr("value",{getter:function(M,L){return this._getValue(M,L);},writeOnce:true});
}});C.CheckboxField=E;function K(){K.superclass.constructor.apply(this,arguments);}C.mix(K,{NAME:"hidden-field",ATTRS:{displayValue:{value:false,writeOnce:true,validator:C.Lang.isBoolean}}});C.extend(K,C.FormField,{_nodeType:"hidden",_valueDisplayNode:null,_renderValueDisplayNode:function(){if(this.get("displayValue")===true){var M=C.Node.create("<div></div>"),L=this.get("contentBox");L.appendChild(M);this._valueDisplayNode=M;}},renderUI:function(){K.superclass.renderUI.apply(this,arguments);this._renderValueDisplayNode();},bindUI:function(){K.superclass.bindUI.apply(this,arguments);if(this.get("displayValue")===true){this.after("valueChange",C.bind(function(L,M){this._valueDisplayNode.set("innerHTML",M.newVal);},this,true));}}});C.HiddenField=K;function F(){F.superclass.constructor.apply(this,arguments);}C.mix(F,{NAME:"textarea-field",NODE_TEMPLATE:"<textarea></textarea>"});C.extend(F,C.FormField,{_renderFieldNode:function(){var L=this.get("contentBox"),M=L.query("#"+this.get("id"));if(!M){M=C.Node.create(C.substitute(F.NODE_TEMPLATE,{name:this.get("name"),type:"text",id:this.get("id"),value:this.get("value")}));L.appendChild(M);}M.setAttribute("tabindex",C.FormField.tabIndex);C.FormField.tabIndex++;this._fieldNode=M;}});C.TextareaField=F;function J(){J.superclass.constructor.apply(this,arguments);}C.mix(J,{NAME:"choice-field",ATTRS:{choices:{validator:function(L){return this._validateChoices(L);}},multiple:{validator:C.Lang.isBoolean,value:false}}});C.extend(J,C.FormField,{_validateChoices:function(M){if(!C.Lang.isArray(M)){return false;}var L=true;C.Array.each(M,function(P,O,N){if(!C.Lang.isObject(P)){L=false;return;}if(!P.label||!C.Lang.isString(P.label)||!P.value||!C.Lang.isString(P.value)){L=false;return;}});return L;},_renderLabelNode:function(){var L=this.get("contentBox"),M=C.Node.create("<span>"+this.get("label")+"</span>");L.appendChild(M);this._labelNode=M;},_renderFieldNode:function(){var L=this.get("contentBox"),O=this.get("choices"),M,N;C.Array.each(O,function(R,Q,P){M=C.Node.create(D.LABEL_TEMPLATE);L.appendChild(M);N=C.Node.create(D.INPUT_TEMPLATE);L.appendChild(N);});this._fieldNode=L.all("input");},_syncFieldNode:function(){var O=this.get("choices"),L=this.get("contentBox"),N=L.all("label"),M=(this.get("multiple")===true?"checkbox":"radio");N.each(function(Q,P,R){Q.setAttrs({innerHTML:O[P].label});Q.setAttribute("for",(this.get("id")+"_choice"+P));},this);this._fieldNode.each(function(R,P,S){R.setAttrs({value:O[P].value,id:(this.get("id")+"_choice"+P),name:this.get("name"),type:M});var Q=C.Node.getDOMNode(R);Q.value=O[P].value;},this);},clear:function(){this._fieldNode.each(function(M,L,N){M.setAttribute("checked",false);},this);this.set("value","");},bindUI:function(){this._fieldNode.on("change",C.bind(function(L){this._fieldNode.each(function(N,M,O){if(N.get("checked")===true){this.set("value",N.get("value"));}},this);},this));}});C.ChoiceField=J;function B(){B.superclass.constructor.apply(this,arguments);}C.mix(B,{NAME:"select-field",NODE_TEMPLATE:"<select></select>",OPTION_TEMPLATE:"<option></option>"});C.extend(B,C.ChoiceField,{_renderFieldNode:function(){var L=this.get("contentBox"),M=L.query("#"+this.get("id"));if(!M){M=C.Node.create(B.NODE_TEMPLATE);L.appendChild(M);}this._fieldNode=M;this._renderOptionNodes();},_renderOptionNodes:function(){var M=this.get("choices"),L;L=C.Node.create(B.OPTION_TEMPLATE);this._fieldNode.appendChild(L);C.Array.each(M,function(P,O,N){L=C.Node.create(B.OPTION_TEMPLATE);this._fieldNode.appendChild(L);},this);},_syncFieldNode:function(){this._fieldNode.setAttrs({name:this.get("name"),id:this.get("id"),multiple:(this.get("multiple")===true?"multiple":"")});},_syncOptionNodes:function(){var N=this.get("choices"),L=this.get("contentBox"),M=L.all("option");M.each(function(R,Q,P){var O=(Q===0?"Choose one":N[Q-1].label),S=(Q===0?"":N[Q-1].value);R.setAttrs({innerHTML:O,value:S});},this);},clear:function(){this._fieldNode.value="";},bindUI:function(){B.superclass.constructor.superclass.bindUI.apply(this,arguments);},syncUI:function(){B.superclass.syncUI.apply(this,arguments);this._syncOptionNodes();}});C.SelectField=B;function G(){G.superclass.constructor.apply(this,arguments);}C.mix(G,{NAME:"button",HTML_PARSER:{},ATTRS:{onclick:{validator:function(L){if(C.Lang.isObject(L)===false){return false;}if(typeof L.fn=="undefined"||C.Lang.isFunction(L.fn)===false){return false;}return true;},value:{fn:function(L){}},setter:function(L){L.scope=L.scope||this;L.argument=L.argument||{};return L;}}},NODE_TEMPLATE:"<button></button>"});C.extend(G,C.FormField,{_renderButtonNode:function(){var L=this.get("contentBox"),M;M=C.Node.create(G.NODE_TEMPLATE);L.appendChild(M);this._fieldNode=M;},_syncLabelNode:function(){},_syncFieldNode:function(){this._fieldNode.setAttrs({innerHTML:this.get("label"),id:this.get("id")});},_setClickHandler:function(){if(!this._fieldNode){return;}var L=this.get("onclick");C.Event.purgeElement(this._fieldNode,true,"click");C.on("click",C.bind(L.fn,L.scope,true),this._fieldNode);},renderUI:function(){this._renderButtonNode();},bindUI:function(){this.after("onclickChange",C.bind(this._setClickHandler,this,true));this._setClickHandler();}});C.Button=G;},"gallery-2009.12.08-22",{requires:["node","widget","io-base"]});