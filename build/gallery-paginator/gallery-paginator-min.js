YUI.add("gallery-paginator",function(A){A.Node.DOM_EVENTS.key={on:A.Env.evt.plugins.key.on};"use strict";function B(C){B.superclass.constructor.call(this,C);}A.mix(B,{NAME:"paginator",id:0,ID_BASE:"yui-pg-",VALUE_UNLIMITED:-1,TEMPLATE_DEFAULT:"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}",TEMPLATE_ROWS_PER_PAGE:"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}",ui:{},isNumeric:function(C){return isFinite(+C);},toNumber:function(C){return isFinite(+C)?+C:null;}},true);B.ATTRS={rowsPerPage:{value:0,validator:B.isNumeric,setter:B.toNumber},totalRecords:{value:0,validator:B.isNumeric,setter:B.toNumber},recordOffset:{value:0,validator:function(D){var C=this.get("totalRecords");if(B.isNumeric(D)){D=+D;return C===B.VALUE_UNLIMITED||C>D||(C===0&&D===0);}return false;},setter:B.toNumber},initialPage:{value:1,validator:B.isNumeric,setter:B.toNumber},template:{value:B.TEMPLATE_DEFAULT,validator:A.Lang.isString},alwaysVisible:{value:true,validator:A.Lang.isBoolean},updateOnChange:{value:false,validator:A.Lang.isBoolean},id:{value:B.id++,readOnly:true}};A.extend(B,A.Widget,{_batch:false,_pageChanged:false,_state:null,initializer:function(F){var H=B.VALUE_UNLIMITED,C,D,E,G;this._selfSubscribe();C=this.get("initialPage");D=this.get("totalRecords");E=this.get("rowsPerPage");if(C>1&&E!==H){G=(C-1)*E;if(D===H||G<D){this.set("recordOffset",G);}}},_selfSubscribe:function(){this.after("totalRecordsChange",this.updateVisibility,this);this.after("alwaysVisibleChange",this.updateVisibility,this);this.after("totalRecordsChange",this._handleStateChange,this);this.after("recordOffsetChange",this._handleStateChange,this);this.after("rowsPerPageChange",this._handleStateChange,this);this.after("totalRecordsChange",this._syncRecordOffset,this);},renderUI:function(){this._renderTemplate(this.get("contentBox"),this.get("template"),B.ID_BASE+this.get("id"),true);this.updateVisibility();},_renderTemplate:function(C,G,F,D){if(!C){return;}C.setStyle("display","none");C.addClass(this.getClassName());var E=this.getClassName("ui");C.set("innerHTML",G.replace(/\{([a-z0-9_ \-]+)\}/gi,'<span class="'+E+" "+E+'-$1"></span>'));C.all("span."+E).each(function(H){this.renderUIComponent(H,F);},this);if(!D){C.setStyle("display","");}},renderUIComponent:function(C,I){var H=C.get("parentNode"),G=this.getClassName("ui"),F=new RegExp(G+"-(\\w+)").exec(C.get("className")),E=F&&B.ui[F[1]],D;if(A.Lang.isFunction(E)){D=new E(this);if(A.Lang.isFunction(D.render)){H.replaceChild(D.render(I),C);}}},updateVisibility:function(H){var D=this.get("alwaysVisible"),J,I,F,G,E,C;if(!H||H.type==="alwaysVisibleChange"||!D){J=this.get("totalRecords");I=true;F=this.get("rowsPerPage");G=this.get("rowsPerPageOptions");if(A.Lang.isArray(G)){for(E=0,C=G.length;E<C;++E){F=Math.min(F,G[E]);}}if(J!==B.VALUE_UNLIMITED&&J<=F){I=false;}I=I||D;this.get("contentBox").setStyle("display",I?"":"none");}},getTotalPages:function(){var C=this.get("totalRecords"),D=this.get("rowsPerPage");if(!D){return null;}if(C===B.VALUE_UNLIMITED){return B.VALUE_UNLIMITED;}return Math.ceil(C/D);},hasPage:function(D){if(!A.Lang.isNumber(D)||D<1){return false;}var C=this.getTotalPages();return(C===B.VALUE_UNLIMITED||C>=D);},getCurrentPage:function(){var C=this.get("rowsPerPage");if(!C||!this.get("totalRecords")){return 0;}return Math.floor(this.get("recordOffset")/C)+1;},hasNextPage:function(){var C=this.getCurrentPage(),D=this.getTotalPages();return C&&(D===B.VALUE_UNLIMITED||C<D);},getNextPage:function(){return this.hasNextPage()?this.getCurrentPage()+1:null;},hasPreviousPage:function(){return(this.getCurrentPage()>1);},getPreviousPage:function(){return(this.hasPreviousPage()?this.getCurrentPage()-1:1);},getPageRecords:function(F){if(!A.Lang.isNumber(F)){F=this.getCurrentPage();}var E=this.get("rowsPerPage"),D=this.get("totalRecords"),G,C;if(!F||!E){return null;}G=(F-1)*E;if(D!==B.VALUE_UNLIMITED){if(G>=D){return null;}C=Math.min(G+E,D)-1;}else{C=G+E-1;}return[G,C];},setPage:function(D,C){if(this.hasPage(D)&&D!==this.getCurrentPage()){if(this.get("updateOnChange")||C){this.set("recordOffset",(D-1)*this.get("rowsPerPage"));}else{this.fire("changeRequest",this.getState({"page":D}));}}},getRowsPerPage:function(){return this.get("rowsPerPage");},setRowsPerPage:function(D,C){if(B.isNumeric(D)&&+D>0&&+D!==this.get("rowsPerPage")){if(this.get("updateOnChange")||C){this.set("rowsPerPage",D);}else{this.fire("changeRequest",this.getState({"rowsPerPage":+D}));}}},getTotalRecords:function(){return this.get("totalRecords");},setTotalRecords:function(D,C){if(B.isNumeric(D)&&+D>=0&&+D!==this.get("totalRecords")){if(this.get("updateOnChange")||C){this.set("totalRecords",D);}else{this.fire("changeRequest",this.getState({"totalRecords":+D}));}}},getStartIndex:function(){return this.get("recordOffset");},setStartIndex:function(D,C){if(B.isNumeric(D)&&+D>=0&&+D!==this.get("recordOffset")){if(this.get("updateOnChange")||C){this.set("recordOffset",D);}else{this.fire("changeRequest",this.getState({"recordOffset":+D}));}}},getState:function(I){var K=B.VALUE_UNLIMITED,G=Math,H=G.max,J=G.ceil,E,C,F;function D(N,L,M){if(N<=0||L===0){return 0;}if(L===K||L>N){return N-(N%M);}return L-(L%M||M);}E={paginator:this,totalRecords:this.get("totalRecords"),rowsPerPage:this.get("rowsPerPage"),records:this.getPageRecords()};E.recordOffset=D(this.get("recordOffset"),E.totalRecords,E.rowsPerPage);E.page=J(E.recordOffset/E.rowsPerPage)+1;if(!I){return E;}C={paginator:this,before:E,rowsPerPage:I.rowsPerPage||E.rowsPerPage,totalRecords:(B.isNumeric(I.totalRecords)?H(I.totalRecords,K):+E.totalRecords)};if(C.totalRecords===0){C.recordOffset=C.page=0;}else{F=B.isNumeric(I.page)?(I.page-1)*C.rowsPerPage:B.isNumeric(I.recordOffset)?+I.recordOffset:E.recordOffset;C.recordOffset=D(F,C.totalRecords,C.rowsPerPage);C.page=J(C.recordOffset/C.rowsPerPage)+1;}C.records=[C.recordOffset,C.recordOffset+C.rowsPerPage-1];if(C.totalRecords!==K&&C.recordOffset<C.totalRecords&&C.records&&C.records[1]>C.totalRecords-1){C.records[1]=C.totalRecords-1;
}return C;},setState:function(D){if(A.Lang.isObject(D)){this._state=this.getState({});D={page:D.page,rowsPerPage:D.rowsPerPage,totalRecords:D.totalRecords,recordOffset:D.recordOffset};if(D.page&&D.recordOffset===undefined){D.recordOffset=(D.page-1)*(D.rowsPerPage||this.get("rowsPerPage"));}this._batch=true;this._pageChanged=false;for(var C in D){if(D.hasOwnProperty(C)&&this._configs.hasOwnProperty(C)){this.set(C,D[C]);}}this._batch=false;if(this._pageChanged){this._pageChanged=false;this._firePageChange(this.getState(this._state));}}},_syncRecordOffset:function(F){var C=F.newValue,E,D;if(F.prevValue!==C){if(C!==B.VALUE_UNLIMITED){E=this.get("rowsPerPage");if(E&&this.get("recordOffset")>=C){D=this.getState({totalRecords:F.prevValue,recordOffset:this.get("recordOffset")});this.set("recordOffset",D.before.recordOffset);this._firePageChange(D);}}}},_handleStateChange:function(D){if(D.prevValue!==D.newValue){var E=this._state||{},C;E[D.type.replace(/Change$/,"")]=D.prevValue;C=this.getState(E);if(C.page!==C.before.page){if(this._batch){this._pageChanged=true;}else{this._firePageChange(C);}}}},_firePageChange:function(C){if(A.Lang.isObject(C)){var D=C.before;delete C.before;this.fire("pageChange",{type:"pageChange",prevValue:C.page,newValue:D.page,prevState:C,newState:D});}}});A.Paginator=B;B.ui.CurrentPageInput=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("pageInputClassChange",this.update,this);};B.ATTRS.pageInputClass={value:A.ClassNameManager.getClassName(B.NAME,"page-input"),validator:A.Lang.isString};B.ATTRS.pageInputTemplate={value:"{currentPage} of {totalPages}",validator:A.Lang.isString};B.ui.CurrentPageInput.prototype={destroy:function(){this.span.remove(true);this.span=null;this.input=null;this.page_count=null;},render:function(C){this.span=A.Node.create('<span id="'+C+'-page-input">'+A.substitute(this.paginator.get("pageInputTemplate"),{currentPage:'<input class="yui-page-input"></input>',totalPages:'<span class="yui-page-count"></span>'})+"</span>");this.span.set("className",this.paginator.get("pageInputClass"));this.input=this.span.one("input");this.input.on("change",this._onChange,this);this.input.on("key",this._onReturnKey,"down:13",this);this.page_count=this.span.one("span.yui-page-count");this.update();return this.span;},update:function(C){if(C&&C.prevVal===C.newVal){return;}this.span.set("className",this.paginator.get("pageInputClass"));this.input.set("value",this.paginator.getCurrentPage());this.page_count.set("innerHTML",this.paginator.getTotalPages());},_onChange:function(C){this.paginator.setPage(parseInt(this.input.get("value"),10));},_onReturnKey:function(C){C.halt(true);this.paginator.setPage(parseInt(this.input.get("value"),10));}};B.ui.CurrentPageReport=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("pageReportClassChange",this.update,this);C.after("pageReportTemplateChange",this.update,this);};B.ATTRS.pageReportClass={value:A.ClassNameManager.getClassName(B.NAME,"current"),validator:A.Lang.isString};B.ATTRS.pageReportTemplate={value:"({currentPage} of {totalPages})",validator:A.Lang.isString};B.ATTRS.pageReportValueGenerator={value:function(E){var D=E.getCurrentPage(),C=E.getPageRecords();return{"currentPage":C?D:0,"totalPages":E.getTotalPages(),"startIndex":C?C[0]:0,"endIndex":C?C[1]:0,"startRecord":C?C[0]+1:0,"endRecord":C?C[1]+1:0,"totalRecords":E.get("totalRecords")};},validator:A.Lang.isFunction};B.ui.CurrentPageReport.sprintf=function(D,C){return D.replace(/\{([\w\s\-]+)\}/g,function(E,F){return(F in C)?C[F]:"";});};B.ui.CurrentPageReport.prototype={span:null,destroy:function(){this.span.remove(true);this.span=null;},render:function(C){this.span=A.Node.create('<span id="'+C+'-page-report"></span>');this.span.set("className",this.paginator.get("pageReportClass"));this.update();return this.span;},update:function(C){if(C&&C.prevVal===C.newVal){return;}this.span.set("className",this.paginator.get("pageReportClass"));this.span.set("innerHTML",B.ui.CurrentPageReport.sprintf(this.paginator.get("pageReportTemplate"),this.paginator.get("pageReportValueGenerator")(this.paginator)));}};B.ui.FirstPageLink=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("firstPageLinkLabelChange",this.rebuild,this);C.after("firstPageLinkClassChange",this.rebuild,this);};B.ATTRS.firstPageLinkLabel={value:"&lt;&lt; first",validator:A.Lang.isString};B.ATTRS.firstPageLinkClass={value:A.ClassNameManager.getClassName(B.NAME,"first"),validator:A.Lang.isString};B.ui.FirstPageLink.prototype={current:null,link:null,span:null,destroy:function(){this.link.remove(true);this.span.remove(true);this.current=this.link=this.span=null;},render:function(D){var E=this.paginator,F=E.get("firstPageLinkClass"),C=E.get("firstPageLinkLabel");this.link=A.Node.create('<a href="#" id="'+D+'-first-link">'+C+"</a>");this.link.set("className",F);this.link.on("click",this.onClick,this);this.span=A.Node.create('<span id="'+D+'-first-span">'+C+"</span>");this.span.set("className",F);this.current=E.getCurrentPage()>1?this.link:this.span;return this.current;},update:function(D){if(D&&D.prevVal===D.newVal){return;}var C=this.current?this.current.get("parentNode"):null;if(this.paginator.getCurrentPage()>1){if(C&&this.current===this.span){C.replaceChild(this.link,this.current);this.current=this.link;}}else{if(C&&this.current===this.link){C.replaceChild(this.span,this.current);this.current=this.span;}}},rebuild:function(E){if(E&&E.prevVal===E.newVal){return;}var D=this.paginator,F=D.get("firstPageLinkClass"),C=D.get("firstPageLinkLabel");this.link.set("className",F);
this.link.set("innerHTML",C);this.span.set("className",F);this.span.set("innerHTML",C);},onClick:function(C){C.halt();this.paginator.setPage(1);}};B.ui.ItemRangeDropdown=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("itemRangeDropdownClassChange",this.update,this);};B.ATTRS.itemRangeDropdownClass={value:A.ClassNameManager.getClassName(B.NAME,"ir-dropdown"),validator:A.Lang.isString};B.ATTRS.itemRangeDropdownTemplate={value:"{currentRange} of {totalItems}",validator:A.Lang.isString};B.ui.ItemRangeDropdown.prototype={destroy:function(){this.span.remove(true);this.span=null;this.menu=null;this.page_count=null;},render:function(C){this.span=A.Node.create('<span id="'+C+'-item-range">'+A.substitute(this.paginator.get("itemRangeDropdownTemplate"),{currentRange:'<select class="yui-current-item-range"></select>',totalItems:'<span class="yui-item-count"></span>'})+"</span>");this.span.set("className",this.paginator.get("itemRangeDropdownClass"));this.menu=this.span.one("select");this.menu.on("change",this._onChange,this);this.page_count=this.span.one("span.yui-item-count");this.update();return this.span;},update:function(H){if(H&&H.prevVal===H.newVal){return;}var G=this.paginator.getCurrentPage();var F=this.paginator.getTotalPages();var D=A.Node.getDOMNode(this.menu).options;D.length=0;for(var E=1;E<=F;E++){var C=this.paginator.getPageRecords(E);D[E-1]=new Option((C[0]+1)+" - "+(C[1]+1),E);if(E==G){this.menu.set("selectedIndex",E-1);}}this.span.set("className",this.paginator.get("itemRangeDropdownClass"));this.page_count.set("innerHTML",this.paginator.getTotalRecords());},_onChange:function(C){this.paginator.setPage(parseInt(this.menu.get("value"),10));}};B.ui.LastPageLink=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("lastPageLinkClassChange",this.rebuild,this);C.after("lastPageLinkLabelChange",this.rebuild,this);};B.ATTRS.lastPageLinkClass={value:A.ClassNameManager.getClassName(B.NAME,"last"),validator:A.Lang.isString};B.ATTRS.lastPageLinkLabel={value:"last &gt;&gt;",validator:A.Lang.isString};B.ui.LastPageLink.prototype={current:null,link:null,span:null,na:null,destroy:function(){this.link.remove(true);this.span.remove(true);this.na.remove(true);this.current=this.link=this.span=this.na=null;},render:function(D){var F=this.paginator,G=F.get("lastPageLinkClass"),C=F.get("lastPageLinkLabel"),E=F.getTotalPages();this.link=A.Node.create('<a href="#" id="'+D+'-last-link">'+C+"</a>");this.link.set("className",G);this.link.on("click",this.onClick,this);this.span=A.Node.create('<span id="'+D+'-last-span">'+C+"</span>");this.span.set("className",G);this.na=A.Node.create('<span id="'+D+'-last-na"></span>');switch(E){case B.VALUE_UNLIMITED:this.current=this.na;break;case F.getCurrentPage():this.current=this.span;break;default:this.current=this.link;}return this.current;},update:function(D){if(D&&D.prevVal===D.newVal){return;}var C=this.current?this.current.get("parentNode"):null,E=this.link;if(C){switch(this.paginator.getTotalPages()){case B.VALUE_UNLIMITED:E=this.na;break;case this.paginator.getCurrentPage():E=this.span;break;}if(this.current!==E){C.replaceChild(E,this.current);this.current=E;}}},rebuild:function(E){if(E&&E.prevVal===E.newVal){return;}var D=this.paginator,F=D.get("lastPageLinkClass"),C=D.get("lastPageLinkLabel");this.link.set("className",F);this.link.set("innerHTML",C);this.span.set("className",F);this.span.set("innerHTML",C);},onClick:function(C){C.halt();this.paginator.setPage(this.paginator.getTotalPages());}};B.ui.NextPageLink=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("nextPageLinkClassChange",this.rebuild,this);C.after("nextPageLinkLabelChange",this.rebuild,this);};B.ATTRS.nextPageLinkClass={value:A.ClassNameManager.getClassName(B.NAME,"next"),validator:A.Lang.isString};B.ATTRS.nextPageLinkLabel={value:"next &gt;",validator:A.Lang.isString};B.ui.NextPageLink.prototype={current:null,link:null,span:null,destroy:function(){this.link.remove(true);this.span.remove(true);this.current=this.link=this.span=null;},render:function(D){var F=this.paginator,G=F.get("nextPageLinkClass"),C=F.get("nextPageLinkLabel"),E=F.getTotalPages();this.link=A.Node.create('<a href="#" id="'+D+'-next-link">'+C+"</a>");this.link.set("className",G);this.link.on("click",this.onClick,this);this.span=A.Node.create('<span id="'+D+'-next-span">'+C+"</span>");this.span.set("className",G);this.current=F.getCurrentPage()===E?this.span:this.link;return this.current;},update:function(E){if(E&&E.prevVal===E.newVal){return;}var D=this.paginator.getTotalPages(),C=this.current?this.current.get("parentNode"):null;if(this.paginator.getCurrentPage()!==D){if(C&&this.current===this.span){C.replaceChild(this.link,this.current);this.current=this.link;}}else{if(this.current===this.link){if(C){C.replaceChild(this.span,this.current);this.current=this.span;}}}},rebuild:function(E){if(E&&E.prevVal===E.newVal){return;}var D=this.paginator,F=D.get("nextPageLinkClass"),C=D.get("nextPageLinkLabel");this.link.set("className",F);this.link.set("innerHTML",C);this.span.set("className",F);this.span.set("innerHTML",C);},onClick:function(C){C.halt();this.paginator.setPage(this.paginator.getNextPage());}};B.ui.PageLinks=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("pageLinksContainerClassChange",this.rebuild,this);C.after("pageLinkClassChange",this.rebuild,this);C.after("currentPageClassChange",this.rebuild,this);
C.after("pageLinksChange",this.rebuild,this);};B.ATTRS.pageLinksContainerClass={value:A.ClassNameManager.getClassName(B.NAME,"pages"),validator:A.Lang.isString};B.ATTRS.pageLinkClass={value:A.ClassNameManager.getClassName(B.NAME,"page"),validator:A.Lang.isString};B.ATTRS.currentPageClass={value:A.ClassNameManager.getClassName(B.NAME,"current-page"),validator:A.Lang.isString};B.ATTRS.pageLinks={value:10,validator:B.isNumeric};B.ATTRS.pageLabelBuilder={value:function(C,D){return C;},validator:A.Lang.isFunction};B.ui.PageLinks.calculateRange=function(E,F,D){var I=B.VALUE_UNLIMITED,H,C,G;if(!E||D===0||F===0||(F===I&&D===I)){return[0,-1];}if(F!==I){D=D===I?F:Math.min(D,F);}H=Math.max(1,Math.ceil(E-(D/2)));if(F===I){C=H+D-1;}else{C=Math.min(F,H+D-1);}G=D-(C-H+1);H=Math.max(1,H-G);return[H,C];};B.ui.PageLinks.prototype={current:0,container:null,destroy:function(){this.container.remove(true);this.container=null;},render:function(C){this.container=A.Node.create('<span id="'+C+'-pages"></span>');this.container.on("click",this.onClick,this);this.update({newVal:null,rebuild:true});return this.container;},update:function(J){if(J&&J.prevVal===J.newVal){return;}var E=this.paginator,I=E.getCurrentPage();if(this.current!==I||!I||J.rebuild){var L=E.get("pageLabelBuilder"),H=B.ui.PageLinks.calculateRange(I,E.getTotalPages(),E.get("pageLinks")),D=H[0],F=H[1],K="",C,G;C='<a href="#" class="'+E.get("pageLinkClass")+'" page="';for(G=D;G<=F;++G){if(G===I){K+='<span class="'+E.get("currentPageClass")+" "+E.get("pageLinkClass")+'">'+L(G,E)+"</span>";}else{K+=C+G+'">'+L(G,E)+"</a>";}}this.container.set("className",E.get("pageLinksContainerClass"));this.container.set("innerHTML",K);}},rebuild:function(C){C.rebuild=true;this.update(C);},onClick:function(D){var C=D.target;if(C&&C.hasClass(this.paginator.get("pageLinkClass"))){D.halt();this.paginator.setPage(parseInt(C.getAttribute("page"),10));}}};B.ui.PreviousPageLink=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("recordOffsetChange",this.update,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this.update,this);C.after("previousPageLinkLabelChange",this.update,this);C.after("previousPageLinkClassChange",this.update,this);};B.ATTRS.previousPageLinkClass={value:A.ClassNameManager.getClassName(B.NAME,"previous"),validator:A.Lang.isString};B.ATTRS.previousPageLinkLabel={value:"&lt; prev",validator:A.Lang.isString};B.ui.PreviousPageLink.prototype={current:null,link:null,span:null,destroy:function(){this.link.remove(true);this.span.remove(true);this.current=this.link=this.span=null;},render:function(D){var E=this.paginator,F=E.get("previousPageLinkClass"),C=E.get("previousPageLinkLabel");this.link=A.Node.create('<a href="#" id="'+D+'-prev-link">'+C+"</a>");this.link.set("className",F);this.link.on("click",this.onClick,this);this.span=A.Node.create('<span id="'+D+'-prev-span">'+C+"</span>");this.span.set("className",F);this.current=E.getCurrentPage()>1?this.link:this.span;return this.current;},update:function(D){if(D&&D.prevVal===D.newVal){return;}var C=this.current?this.current.get("parentNode"):null;if(this.paginator.getCurrentPage()>1){if(C&&this.current===this.span){C.replaceChild(this.link,this.current);this.current=this.link;}}else{if(C&&this.current===this.link){C.replaceChild(this.span,this.current);this.current=this.span;}}},onClick:function(C){C.halt();this.paginator.setPage(this.paginator.getPreviousPage());}};B.ui.RowsPerPageDropdown=function(C){this.paginator=C;C.on("destroy",this.destroy,this);C.after("rowsPerPageChange",this.update,this);C.after("totalRecordsChange",this._handleTotalRecordsChange,this);C.after("rowsPerPageDropdownClassChange",this.rebuild,this);C.after("rowsPerPageDropdownTitleChange",this.rebuild,this);C.after("rowsPerPageOptionsChange",this.rebuild,this);};B.ATTRS.rowsPerPageDropdownClass={value:A.ClassNameManager.getClassName(B.NAME,"rpp-options"),validator:A.Lang.isString};B.ATTRS.rowsPerPageDropdownTitle={value:"Rows per page",validator:A.Lang.isString};B.ATTRS.rowsPerPageOptions={value:[],validator:A.Lang.isArray};B.ui.RowsPerPageDropdown.prototype={select:null,all:null,destroy:function(){this.select.remove(true);this.all=this.select=null;},render:function(C){this.select=A.Node.create('<select id="'+C+'-rpp"></select>');this.select.on("change",this.onChange,this);this.rebuild();return this.select;},rebuild:function(K){var D=this.paginator,F=this.select,L=D.get("rowsPerPageOptions"),C=A.Node.getDOMNode(F).options,E,J,G,H,I;this.all=null;F.set("className",this.paginator.get("rowsPerPageDropdownClass"));F.set("title",this.paginator.get("rowsPerPageDropdownTitle"));for(H=0,I=L.length;H<I;++H){J=L[H];E=C[H]||F.appendChild(A.Node.create("<option/>"));G=A.Lang.isValue(J.value)?J.value:J;E.set("innerHTML",A.Lang.isValue(J.text)?J.text:J);if(A.Lang.isString(G)&&G.toLowerCase()==="all"){this.all=E;E.set("value",D.get("totalRecords"));}else{E.set("value",G);}}while(C.length>L.length){F.get("lastChild").remove();}this.update();},update:function(G){if(G&&G.prevVal===G.newVal){return;}var F=this.paginator.get("rowsPerPage")+"",D=A.Node.getDOMNode(this.select).options,E,C;for(E=0,C=D.length;E<C;++E){if(D[E].value===F){D[E].selected=true;break;}}},onChange:function(C){this.paginator.setRowsPerPage(parseInt(A.Node.getDOMNode(this.select).options[this.select.get("selectedIndex")].value,10));},_handleTotalRecordsChange:function(C){if(!this.all||(C&&C.prevVal===C.newVal)){return;}this.all.set("value",C.newVal);if(this.all.get("selected")){this.paginator.set("rowsPerPage",C.newVal);}}};},"gallery-2010.04.14-19-47",{requires:["widget","event-key","substitute"]});